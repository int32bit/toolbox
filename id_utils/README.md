## 18身份证号码的结构

公民身份号码是特征组合码，由十七位数字本体码和一位校验码组成。
排列顺序从左至右依次为：六位数字地址码，八位数字出生日期码，三位数字顺序码和一位校验码。 

### 1. 地址码 

表示编码对象常住户口所在县(市、旗、区)的行政区域划分代码，按GB/T2260的规定执行，参考[中华人民共和国国家统计局](http://www.stats.gov.cn/tjsj/tjbz/xzqhdm/)。
此次参考的数据库是[最新县及县以上行政区划代码(截止2015年9月30日)](http://www.stats.gov.cn/tjsj/tjbz/xzqhdm/201608/t20160809_1386477.html)

### 2. 出生日期码 

表示编码对象出生的年、月、日，按GB/T7408的规定执行，年、月、日代码之间不用分隔符。 

### 3. 顺序码 

表示在同一地址码所标识的区域范围内，对同年、同月、同日出生的人编定的顺序号，**顺序码的奇数分配给男性，偶数分配给女性**。

### 4. 校验码计算步骤

(1)十七位数字本体码加权求和公式 

先对前17位数字的权求和

```
S = Sum(Ai * Wi), i = 0, ... , 16，先对前17位数字的权求和 
```

* Ai:表示第i位置上的身份证号码数字值(0~9) 
* Wi:7 9 10 5 8 4 2 1 6 3 7 9 10 5 8 4 2 （表示第i位置上的加权因子）

(2)计算模 

```
Y = mod(S, 11)
```

(3)根据模，查找得到对应的校验码 

* Y: 0 1 2 3 4 5 6 7 8 9 10 
* 校验码: 1 0 X 9 8 7 6 5 4 3 2

Python代码实现:

```python
def get_checkcode_by_id(id):
    weight = [7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2]
    check_code = ['1','0','X','9','8','7','6','5','4','3','2']
    sum = 0
    for i in range(len(id) - 1):
        sum += int(id[i]) * weight[i]
    return check_code[sum % 11]
```

## 身份证号码应用工具

根据身份证号码，实现了以下功能:

* 验证身份证是否合法
* 计算校验码
* 查询归属地
* 查询出生年月
* 查询性别
* 计算年龄

使用Python的特性:

* 带参数的注解装饰器
* python二分查找bisect,不支持自定义key，返回的是插入位置，元素不存在时需要额外判断
* 使用prettytable库打印表格

## DEMO实例

测试代码如下:

```python
#!/usr/bin/python
#coding=utf-8
# main.py

from id_util import *

if __name__ == "__main__":
    data = list()
    with open("test_id_number.txt", "r") as f:
        for line in f:
            data.append(line.split()[0].strip())
    print_info(data)
```

输入:

```
230402198305011645
450800197605074336
370881199110247327
431122197505010228
341226198305132662
440308199302136799
330105198203120257
130225198706213766
341126199109168667
451423197906084638
532927199209039092
220204197507112191
320202199002136999
410100199112246498
430981197809111004
420583199411089626
640104198608238807
450521198104063823
441821198006076626
```

终端运行:

```bash
python main.py
```

输出:

```
+--------------------+------+------+------------+--------------------------+--------+
|       身份证       | 性别 | 年龄 |  出生年月  |         发证地点         | 校验码 |
+--------------------+------+------+------------+--------------------------+--------+
| 230402198305011645 |  女  |  33  | 1983-05-01 |      黑龙江省向阳区      |   5    |
| 450800197605074336 |  男  |  40  | 1976-05-07 |       广西省贵港市       |   6    |
| 370881199110247327 |  女  |  25  | 1991-10-24 |       山东省曲阜市       |   7    |
| 431122197505010228 |  女  |  41  | 1975-05-01 |       湖南省东安县       |   8    |
| 341226198305132662 |  女  |  33  | 1983-05-13 |       安徽省颍上县       |   2    |
| 440308199302136799 |  男  |  23  | 1993-02-13 |       广东省盐田区       |   9    |
| 330105198203120257 |  男  |  34  | 1982-03-12 |       浙江省拱墅区       |   7    |
| 130225198706213766 |  女  |  29  | 1987-06-21 |       河北省乐亭县       |   6    |
| 341126199109168667 |  女  |  25  | 1991-09-16 |       安徽省凤阳县       |   7    |
| 451423197906084638 |  男  |  37  | 1979-06-08 |       广西省龙州县       |   8    |
| 532927199209039092 |  男  |  24  | 1992-09-03 | 云南省巍山彝族回族自治县 |   2    |
| 220204197507112191 |  男  |  41  | 1975-07-11 |       吉林省船营区       |   1    |
| 320202199002136999 |  男  |  26  | 1990-02-13 |       江苏省崇安区       |   9    |
| 410100199112246498 |  男  |  25  | 1991-12-24 |       河南省郑州市       |   8    |
| 430981197809111004 |  女  |  38  | 1978-09-11 |       湖南省沅江市       |   4    |
| 420583199411089626 |  女  |  22  | 1994-11-08 |       湖北省枝江市       |   6    |
| 640104198608238807 |  女  |  30  | 1986-08-23 |       宁夏省兴庆区       |   7    |
| 450521198104063823 |  女  |  35  | 1981-04-06 |       广西省合浦县       |   3    |
| 441821198006076626 |  女  |  36  | 1980-06-07 |       广东省佛冈县       |   6    |
| 440281198904154510 |  男  |  27  | 1989-04-15 |       广东省乐昌市       |   0    |
+--------------------+------+------+------------+--------------------------+--------+
```

## 参考

1. [身份证号码验证算法](https://mp.weixin.qq.com/s?__biz=MjM5NzA1MTcyMA==&mid=2651161705&idx=1&sn=57230b31504ab2ff050f032c5c945b7e&scene=1&srcid=0904HXCmsK2mIuBU1eOOC3mc&key=7b81aac53bd2393d617f82606197c3acbb3fec9754cf03ac9b5d9534483b2981c28caebdfea7204a5804048bcabbb021&ascene=0&uin=MTEyMTE0MTE1&devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.11.4+build(15E65)&version=11020201&pass_ticket=QLogZbyT2gM2eFEB%2F6z0M59KVibK0IvCjqhd0QOWaAQ%3D)
2. [Python修饰器的函数式编程](http://coolshell.cn/articles/11265.html)
